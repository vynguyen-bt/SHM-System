<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>SHM - BIM</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <link rel="stylesheet" href="css/main.css" />
    <link rel="stylesheet" href="css/styles.css" />
    <style>
      /* Tối ưu hiệu suất canvas cho Plotly */
      canvas {
        will-change: auto;
        image-rendering: optimizeSpeed;
        image-rendering: -moz-crisp-edges;
        image-rendering: -webkit-optimize-contrast;
        image-rendering: optimize-contrast;
      }
      
      #damage3DChart {
        max-width: 100%;
        height: auto;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.0.0"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/numeric/1.2.6/numeric.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  </head>
  <body>
    <h1>HỆ THỐNG CHẨN ĐOÁN HƯ HỎNG KẾT CẤU - SHM</h1>
    <div class="main-part">
      <button onclick="switchToPartB1()" class="button-open">
        0. Mô phỏng hư hỏng
      </button>
      <div class="body-part">
        <div id="partB1">
          <div class="container">
            <h1>0. Mô phỏng hư hỏng</h1>
            <label for="txt-file-delta-x" style="display: none"
              >Tải tệp thông tin phần tử (TXT file):</label
            >
            <input
              type="file"
              id="txt-file-delta-x"
              accept=".txt"
              onchange="readDeltaX()"
              style="display: none"
            />
            <label for="folder-input"
              ><strong>Tải thư mục dữ liệu:</strong></label
            >
            <input
              type="file"
              id="folder-input"
              webkitdirectory
              directory
              multiple
            />
            <label for="survey-index"
              ><strong>Nhập phần tử mô phỏng 1:</strong></label
            >
            <input type="number" id="survey-index" min="1" />
            <label for="damage-value"
              ><strong>Nhập mức độ hư hỏng 1 (%):</strong></label
            >
            <input type="number" id="damage-value" min="0" />
            <label for="survey-index2"
              ><strong>Nhập phần tử mô phỏng 2:</strong></label
            >
            <input type="number" id="survey-index2" min="1" />
            <label for="damage-value2"
              ><strong>Nhập mức độ hư hỏng 2 (%):</strong></label
            >
            <input type="number" id="damage-value2" min="0" />
            <label for="survey-index3"
              ><strong>Nhập phần tử mô phỏng 3:</strong></label
            >
            <input type="number" id="survey-index3" min="1" />
            <label for="damage-value3"
              ><strong>Nhập mức độ hư hỏng 3 (%):</strong></label
            >
            <input type="number" id="damage-value3" min="0" />
            <button onclick="exportValue()">Xuất dữ liệu</button>
          </div>
        </div>
      </div>
    </div>
    <div class="main-part">
      <button onclick="switchToPartA()" class="button-open">
        1. Chẩn đoán vị trí hư hỏng kết cấu
      </button>
      <div class="body-part">
        <div id="partA">
          <div class="container">
            <h1>1. Chẩn đoán vị trí hư hỏng kết cấu</h1>
            <label for="txt-file-non-damaged" style="display: none"
              >Tải dữ liệu dạng dao động (Không hư hỏng, TXT file):</label
            >
            <input
              type="file"
              id="txt-file-non-damaged"
              accept=".txt"
              style="display: none"
            />
            <label for="txt-file-damaged" style="display: none"
              >Tải dữ liệu dạng dao động (Hư hỏng, TXT file):</label
            >
            <input
              type="file"
              id="txt-file-damaged"
              accept=".txt"
              style="display: none"
            />
            <h2>Thông số chẩn đoán</h2>
            <label for="mode-number"
              ><strong>Chọn Mode khảo sát:</strong></label
            >
            <select id="mode-number">
              <option value="1">Mode 1</option>
              <option value="2">Mode 2</option>
              <option value="3">Mode 3</option>
              <option value="4">Mode 4</option>
              <option value="5">Mode 5</option>
              <option value="6">Mode 6</option>
              <option value="7">Mode 7</option>
              <option value="8">Mode 8</option>
              <option value="9">Mode 9</option>
              <option value="10">Mode 10</option>
              <option value="11">Mode 11</option>
              <option value="12">Mode 12</option>
              <option value="13">Mode 13</option>
              <option value="14">Mode 14</option>
              <option value="15">Mode 15</option>
              <option value="16">Mode 16</option>
              <option value="17">Mode 17</option>
              <option value="18">Mode 18</option>
              <option value="19">Mode 19</option>
              <option value="20">Mode 20</option>
              <option value="combine">Mode Combine (10+12+14+17+20)</option>
            </select>
            <label for="curvature-multiplier"
              ><strong>Nhập ngưỡng hư hỏng Z₀ (% giá trị Z lớn nhất):</strong></label
            >
            <input
              type="number"
              id="curvature-multiplier"
              value="50"
              step="0.1"
              min="0"
            />
            <input
              type="number"
              id="poisson-ratio"
              value="0.2"
              step="0.01"
              min="0"
              max="0.5"
              style="display: none;"
            />
            <label for="element-y"
              ><strong>Nhập phần tử khảo sát 1:</strong></label
            >
            <input type="number" id="element-y" value="1" step="any" min="1" />
            <label for="element-y-2"
              ><strong>Nhập phần tử khảo sát 2:</strong></label
            >
            <input type="number" id="element-y-2" value="" step="any" min="1" />
            <label for="element-y-3"
              ><strong>Nhập phần tử khảo sát 3:</strong></label
            >
            <input type="number" id="element-y-3" value="" step="any" min="1" />
            <br />
            <div id="input-container" style="display: none">
              <label for="train-value">Giá trị huấn luyện đầu tiên:</label>
              <input type="number" id="train-value" value="0" step="0.1" />
              <label for="step-value">Bước nhảy:</label>
              <input type="number" id="step-value" value="3" step="0.1" />
            </div>
            <button onclick="processStrainEnergyData()">Tính toán năng lượng biến dạng</button>
            <div id="results"></div>
            <div id="damage3DChart"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="main-part">
      <button
        onclick="switchToPartB(); processFilestrain(); processFileTest();"
        class="button-open"
      >
        2. Chẩn đoán mức độ hư hỏng kết cấu
      </button>
      <div class="body-part">
        <div id="partB" class="body-part">
          <div class="container">
            <h1>2. Chẩn đoán mức độ hư hỏng kết cấu</h1>

            <!-- Hiển thị danh sách phần tử hư hỏng từ mục 1 -->
            <div class="form-group mb-3">
              <label class="form-label">
                <strong>Danh sách phần tử hư hỏng (từ mục 1):</strong>
              </label>
              <div
                id="damagedElementsDisplay"
                class="form-control-plaintext"
                style="background-color: #f8f9fa; padding: 8px; border: 1px solid #dee2e6; border-radius: 4px; max-width: 400px;"
              >
                <span id="damagedElementsText">Chưa có dữ liệu từ mục 1</span>
              </div>
              <small class="form-text text-muted">
                Dữ liệu được lấy tự động từ kết quả phân tích mục 1. Phần tử có damage cao nhất sẽ được ưu tiên.
              </small>
            </div>

            <div class="form-group">
              <label for="trainFile" style="display: none"
                >Tải dữ liệu huấn luyện (.csv):</label
              >
              <input
                type="file"
                id="trainFile"
                class="form-control"
                accept=".csv"
                style="display: none"
              />
            </div>
            <div class="form-group">
              <label for="testFile" style="display: none"
                >Tải dữ liệu chẩn đoán (.csv):</label
              >
              <input
                type="file"
                id="testFile"
                class="form-control"
                accept=".csv"
                style="display: none"
              />
            </div>
            <input
              type="file"
              id="fileInputTest"
              accept=".txt"
              style="display: none"
            />
            <button
              class="btn btn-primary"
              id="trainButton"
              onclick="trainModel()"
              style="display: none"
            >
              Huấn luyện dữ liệu
            </button>
            <button
              class="btn btn-success"
              id="predictButton"
              onclick="predict()"
              style="display: none"
            >
              Dự đoán mức độ hư hỏng
            </button>
            <button class="btn btn-info" onclick="trainAndPredict()">
              Dự đoán mức độ hư hỏng
            </button>
            <div class="progress mt-3" id="progressBar" style="display: none">
              <div
                class="progress-bar progress-bar-striped progress-bar-animated"
                role="progressbar"
                style="width: 0%"
                id="progress"
              ></div>
            </div>
            <table
              class="table table-bordered mt-4"
              id="resultsTable"
              style="display: none"
            >
              <thead>
                <tr>
                  <th>Phần tử 284</th>
                  <th>Phần tử 285</th>
                  <th>Phần tử 286</th>
                </tr>
              </thead>
              <tbody id="resultsBody"></tbody>
            </table>
            <div class="chart-container">
              <canvas id="predictionChart"></canvas>
            </div>
            <div id="prediction3DChart" style="width: 100%; height: 600px; margin-top: 20px;"></div>
            <div id="lowValuesList" hidden>
              <h3>Các phần tử có mức độ hư hỏng dưới 5%:</h3>
              <ul id="lowValues"></ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="main-part">
      <button onclick="switchToPartB3();processDataX();" class="button-open">
        3. Cải thiện chỉ số đánh giá độ chính xác chẩn đoán
      </button>
      <div class="body-part">
        <div id="partB3" class="body-part">
          <div class="container">
            <h1>3. Cải thiện chỉ số đánh giá độ chính xác chẩn đoán</h1>
            <button
              onclick="processDataX()"
              style="visibility: hidden; position: absolute"
            >
              Cải thiện chỉ số đánh giá độ chính xác chẩn đoán
            </button>
            <div id="resultsX"></div>
          </div>
        </div>
      </div>
    </div>
    <script src="js/switch.js"></script>
    <script src="js/calculations.js"></script>
    <script src="js/fileHandling.js"></script>
    <script src="js/chartProcessing.js"></script>
    <script src="js/trainPredict.js"></script>
    <script src="js/TestShm.js"></script>
  </body>
</html>
