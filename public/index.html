<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>SHM - BIM</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <link rel="stylesheet" href="css/main.css" />
    <link rel="stylesheet" href="css/styles.css" />
    <style>
      /* T·ªëi ∆∞u hi·ªáu su·∫•t canvas cho Plotly */
      canvas {
        will-change: auto;
        image-rendering: optimizeSpeed;
        image-rendering: -moz-crisp-edges;
        image-rendering: -webkit-optimize-contrast;
        image-rendering: optimize-contrast;
      }
      
      #damage3DChart {
        max-width: 100%;
        height: auto;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.0.0"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/numeric/1.2.6/numeric.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  </head>
  <body>
    <h1>H·ªÜ TH·ªêNG CH·∫®N ƒêO√ÅN H∆Ø H·ªéNG K·∫æT C·∫§U - SHM</h1>
    <div class="main-part">
      <button onclick="switchToPartB1()" class="button-open">
        0. M√¥ ph·ªèng h∆∞ h·ªèng
      </button>
      <div class="body-part">
        <div id="partB1">
          <div class="container">
            <h1>0. M√¥ ph·ªèng h∆∞ h·ªèng</h1>
            <label for="txt-file-delta-x" style="display: none"
              >T·∫£i t·ªáp th√¥ng tin ph·∫ßn t·ª≠ (TXT file):</label
            >
            <input
              type="file"
              id="txt-file-delta-x"
              accept=".txt"
              onchange="readDeltaX()"
              style="display: none"
            />
            <label for="folder-input"
              ><strong>T·∫£i th∆∞ m·ª•c d·ªØ li·ªáu:</strong></label
            >
            <input
              type="file"
              id="folder-input"
              webkitdirectory
              directory
              multiple
            />
            <label for="survey-index"
              ><strong>Nh·∫≠p ph·∫ßn t·ª≠ m√¥ ph·ªèng 1:</strong></label
            >
            <input type="number" id="survey-index" min="1" />
            <label for="damage-value"
              ><strong>Nh·∫≠p m·ª©c ƒë·ªô h∆∞ h·ªèng 1 (%):</strong></label
            >
            <input type="number" id="damage-value" min="0" />
            <label for="survey-index2"
              ><strong>Nh·∫≠p ph·∫ßn t·ª≠ m√¥ ph·ªèng 2:</strong></label
            >
            <input type="number" id="survey-index2" min="1" />
            <label for="damage-value2"
              ><strong>Nh·∫≠p m·ª©c ƒë·ªô h∆∞ h·ªèng 2 (%):</strong></label
            >
            <input type="number" id="damage-value2" min="0" />
            <label for="survey-index3"
              ><strong>Nh·∫≠p ph·∫ßn t·ª≠ m√¥ ph·ªèng 3:</strong></label
            >
            <input type="number" id="survey-index3" min="1" />
            <label for="damage-value3"
              ><strong>Nh·∫≠p m·ª©c ƒë·ªô h∆∞ h·ªèng 3 (%):</strong></label
            >
            <input type="number" id="damage-value3" min="0" />
            <button onclick="exportValue()">Xu·∫•t d·ªØ li·ªáu</button>
          </div>
        </div>
      </div>
    </div>
    <div class="main-part">
      <button onclick="switchToPartA()" class="button-open">
        1. Ch·∫©n ƒëo√°n v·ªã tr√≠ h∆∞ h·ªèng k·∫øt c·∫•u
      </button>
      <div class="body-part">
        <div id="partA">
          <div class="container">
            <h1>1. Ch·∫©n ƒëo√°n v·ªã tr√≠ h∆∞ h·ªèng k·∫øt c·∫•u</h1>
            <label for="txt-file-non-damaged" style="display: none"
              >T·∫£i d·ªØ li·ªáu d·∫°ng dao ƒë·ªông (Kh√¥ng h∆∞ h·ªèng, TXT file):</label
            >
            <input
              type="file"
              id="txt-file-non-damaged"
              accept=".txt"
              style="display: none"
            />
            <label for="txt-file-damaged" style="display: none"
              >T·∫£i d·ªØ li·ªáu d·∫°ng dao ƒë·ªông (H∆∞ h·ªèng, TXT file):</label
            >
            <input
              type="file"
              id="txt-file-damaged"
              accept=".txt"
              style="display: none"
            />
            <h2>Th√¥ng s·ªë ch·∫©n ƒëo√°n</h2>
            <label for="mode-number"
              ><strong>Ch·ªçn Mode kh·∫£o s√°t:</strong></label
            >
            <select id="mode-number">
              <option value="1">Mode 1</option>
              <option value="2">Mode 2</option>
              <option value="3">Mode 3</option>
              <option value="4">Mode 4</option>
              <option value="5">Mode 5</option>
              <option value="6">Mode 6</option>
              <option value="7">Mode 7</option>
              <option value="8">Mode 8</option>
              <option value="9">Mode 9</option>
              <option value="10">Mode 10</option>
              <option value="11">Mode 11</option>
              <option value="12">Mode 12</option>
              <option value="13">Mode 13</option>
              <option value="14">Mode 14</option>
              <option value="15">Mode 15</option>
              <option value="16">Mode 16</option>
              <option value="17">Mode 17</option>
              <option value="18">Mode 18</option>
              <option value="19">Mode 19</option>
              <option value="20">Mode 20</option>
              <option value="combine">Mode Combine (10+12+14+17+20)</option>
            </select>
            <label for="curvature-multiplier"
              ><strong>Nh·∫≠p ng∆∞·ª°ng h∆∞ h·ªèng Z‚ÇÄ (% gi√° tr·ªã Z l·ªõn nh·∫•t):</strong></label
            >
            <input
              type="number"
              id="curvature-multiplier"
              value="50"
              step="0.1"
              min="0"
            />
            <input
              type="number"
              id="poisson-ratio"
              value="0.2"
              step="0.01"
              min="0"
              max="0.5"
              style="display: none;"
            />
            <label for="element-y"
              ><strong>Nh·∫≠p ph·∫ßn t·ª≠ kh·∫£o s√°t 1:</strong></label
            >
            <input type="number" id="element-y" value="1" step="any" min="1" />
            <label for="element-y-2"
              ><strong>Nh·∫≠p ph·∫ßn t·ª≠ kh·∫£o s√°t 2:</strong></label
            >
            <input type="number" id="element-y-2" value="" step="any" min="1" />
            <label for="element-y-3"
              ><strong>Nh·∫≠p ph·∫ßn t·ª≠ kh·∫£o s√°t 3:</strong></label
            >
            <input type="number" id="element-y-3" value="" step="any" min="1" />
            <br />
            <div id="input-container" style="display: none">
              <label for="train-value">Gi√° tr·ªã hu·∫•n luy·ªán ƒë·∫ßu ti√™n:</label>
              <input type="number" id="train-value" value="0" step="0.1" />
              <label for="step-value">B∆∞·ªõc nh·∫£y:</label>
              <input type="number" id="step-value" value="3" step="0.1" />
            </div>
            <button onclick="processStrainEnergyData()">T√≠nh to√°n nƒÉng l∆∞·ª£ng bi·∫øn d·∫°ng</button>
            <button onclick="downloadMultiMode3DCharts()" id="download-charts-btn" style="background-color: #28a745; color: white; margin-top: 10px;">Download Multi-Mode 3D Charts</button>
            <button onclick="exportCompleteExcelReport()" style="background-color: #198754; color: white; margin-top: 10px;">üìä Xu·∫•t B√°o C√°o Excel Ho√†n Ch·ªânh</button>
            <div id="download-progress" style="margin-top: 10px; display: none;">
              <div style="background-color: #f0f0f0; border-radius: 5px; padding: 10px;">
                <div id="progress-text">Preparing download...</div>
                <div style="background-color: #ddd; border-radius: 10px; margin-top: 5px;">
                  <div id="progress-bar" style="background-color: #28a745; height: 20px; border-radius: 10px; width: 0%; transition: width 0.3s;"></div>
                </div>
              </div>
            </div>
            <div id="excel-progress" style="margin-top: 10px; display: none;">
              <div style="background-color: #e8f5e8; border-radius: 5px; padding: 10px; border: 1px solid #198754;">
                <div id="excel-progress-text">Calculating metrics for all combinations...</div>
                <div style="background-color: #ddd; border-radius: 10px; margin-top: 5px;">
                  <div id="excel-progress-bar" style="background-color: #198754; height: 20px; border-radius: 10px; width: 0%; transition: width 0.3s;"></div>
                </div>
                <div id="excel-progress-details" style="margin-top: 5px; font-size: 12px; color: #666;"></div>
              </div>
            </div>
            <div id="results"></div>
            <div id="damage3DChart"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="main-part">
      <button
        onclick="switchToPartB(); processFilestrain(); processFileTest();"
        class="button-open"
      >
        2. Ch·∫©n ƒëo√°n m·ª©c ƒë·ªô h∆∞ h·ªèng k·∫øt c·∫•u
      </button>
      <div class="body-part">
        <div id="partB" class="body-part">
          <div class="container">
            <h1>2. Ch·∫©n ƒëo√°n m·ª©c ƒë·ªô h∆∞ h·ªèng k·∫øt c·∫•u</h1>

            <!-- Hi·ªÉn th·ªã danh s√°ch ph·∫ßn t·ª≠ h∆∞ h·ªèng t·ª´ m·ª•c 1 -->
            <div class="form-group mb-3">
              <label class="form-label">
                <strong>Danh s√°ch ph·∫ßn t·ª≠ h∆∞ h·ªèng (t·ª´ m·ª•c 1):</strong>
              </label>
              <div
                id="damagedElementsDisplay"
                class="form-control-plaintext"
                style="background-color: #f8f9fa; padding: 8px; border: 1px solid #dee2e6; border-radius: 4px; max-width: 400px;"
              >
                <span id="damagedElementsText">Ch∆∞a c√≥ d·ªØ li·ªáu t·ª´ m·ª•c 1</span>
              </div>
              <small class="form-text text-muted">
                D·ªØ li·ªáu ƒë∆∞·ª£c l·∫•y t·ª± ƒë·ªông t·ª´ k·∫øt qu·∫£ ph√¢n t√≠ch m·ª•c 1. Ph·∫ßn t·ª≠ c√≥ damage cao nh·∫•t s·∫Ω ƒë∆∞·ª£c ∆∞u ti√™n.
              </small>
            </div>

            <div class="form-group">
              <label for="trainFile" style="display: none"
                >T·∫£i d·ªØ li·ªáu hu·∫•n luy·ªán (.csv):</label
              >
              <input
                type="file"
                id="trainFile"
                class="form-control"
                accept=".csv"
                style="display: none"
              />
            </div>
            <div class="form-group">
              <label for="testFile" style="display: none"
                >T·∫£i d·ªØ li·ªáu ch·∫©n ƒëo√°n (.csv):</label
              >
              <input
                type="file"
                id="testFile"
                class="form-control"
                accept=".csv"
                style="display: none"
              />
            </div>
            <input
              type="file"
              id="fileInputTest"
              accept=".txt"
              style="display: none"
            />
            <button
              class="btn btn-primary"
              id="trainButton"
              onclick="trainModel()"
              style="display: none"
            >
              Hu·∫•n luy·ªán d·ªØ li·ªáu
            </button>
            <button
              class="btn btn-success"
              id="predictButton"
              onclick="predict()"
              style="display: none"
            >
              D·ª± ƒëo√°n m·ª©c ƒë·ªô h∆∞ h·ªèng
            </button>
            <button class="btn btn-info" onclick="trainAndPredict()">
              D·ª± ƒëo√°n m·ª©c ƒë·ªô h∆∞ h·ªèng
            </button>
            <div class="progress mt-3" id="progressBar" style="display: none">
              <div
                class="progress-bar progress-bar-striped progress-bar-animated"
                role="progressbar"
                style="width: 0%"
                id="progress"
              ></div>
            </div>
            <table
              class="table table-bordered mt-4"
              id="resultsTable"
              style="display: none"
            >
              <thead>
                <tr>
                  <th>Ph·∫ßn t·ª≠ 284</th>
                  <th>Ph·∫ßn t·ª≠ 285</th>
                  <th>Ph·∫ßn t·ª≠ 286</th>
                </tr>
              </thead>
              <tbody id="resultsBody"></tbody>
            </table>
            <div class="chart-container">
              <canvas id="predictionChart"></canvas>
            </div>
            <div id="prediction3DChart" style="width: 100%; height: 600px; margin-top: 20px;"></div>
            <div id="lowValuesList" hidden>
              <h3>C√°c ph·∫ßn t·ª≠ c√≥ m·ª©c ƒë·ªô h∆∞ h·ªèng d∆∞·ªõi 5%:</h3>
              <ul id="lowValues"></ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="main-part">
      <button onclick="switchToPartB3();processDataX();" class="button-open">
        3. C·∫£i thi·ªán k·∫øt qu·∫£ ch·∫©n ƒëo√°n b∆∞·ªõc 1
      </button>
      <div class="body-part">
        <div id="partB3" class="body-part">
          <div class="container">
            <h1>3. C·∫£i thi·ªán k·∫øt qu·∫£ ch·∫©n ƒëo√°n b∆∞·ªõc 1</h1>
            <button
              onclick="processDataX()"
              style="visibility: hidden; position: absolute"
            >
              C·∫£i thi·ªán ch·ªâ s·ªë ƒë√°nh gi√° ƒë·ªô ch√≠nh x√°c ch·∫©n ƒëo√°n
            </button>
            <div id="resultsX"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="main-part">
      <button onclick="switchToPartB4();processDataX();" class="button-open">
        4. C·∫£i thi·ªán ch·ªâ s·ªë ƒë√°nh gi√° ƒë·ªô ch√≠nh x√°c ch·∫©n ƒëo√°n
      </button>
      <div class="body-part">
        <div id="partB4" class="body-part">
          <div class="container">
            <h1>4. C·∫£i thi·ªán ch·ªâ s·ªë ƒë√°nh gi√° ƒë·ªô ch√≠nh x√°c ch·∫©n ƒëo√°n</h1>
            <button
              onclick="processDataX()"
              style="visibility: hidden; position: absolute"
            >
              C·∫£i thi·ªán ch·ªâ s·ªë ƒë√°nh gi√° ƒë·ªô ch√≠nh x√°c ch·∫©n ƒëo√°n
            </button>
            <div id="resultsX4"></div>
          </div>
        </div>
      </div>
    </div>
    <script src="js/switch.js"></script>
    <script src="js/calculations.js"></script>
    <script src="js/fileHandling.js"></script>
    <script src="js/chartProcessing.js"></script>
    <script src="js/trainPredict.js"></script>
    <script src="js/TestShm.js"></script>
  </body>
</html>
